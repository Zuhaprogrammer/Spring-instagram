<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instagram Profile Page</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }
    .profile-img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
    }
    .story-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ff4500;
      padding: 2px;
    }
    .post-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .profile-header {
      margin-top: 30px;
    }
    .nav-link {
      color: black !important;
    }
    .category-link {
      color: black;
      font-size: 20px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      text-decoration: none;
      transition: color 0.3s;
      cursor: pointer;
    }
    .category-link:hover {
      color: #007bff;
    }
    .category-link i {
      margin-right: 10px;
    }
    .active {
      font-weight: bold;
      color: #000;
    }
    .sticky-sidebar {
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      left: 0;
      width: 250px;
      background-color: white;
      color: black;
      transition: width 0.3s ease-in-out;
      z-index: 1000;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
    }
    .sticky-sidebar.shrink {
      width: 80px; /* Shrink the sidebar */
    }
    .sticky-sidebar .category-text {
      flex-grow: 1;
    }

    /* Hide the text when sidebar is shrunk */
    .sticky-sidebar.shrink .category-text {
      display: none;
    }
    /* New container (col-md-3) */
    .new-container {
      position: fixed;
      top: 0;
      left: 250px; /* Align with the original sidebar width */
      width: 0; /* Initially hidden */
      height: 100%;
      background-color: #f8f9fa;
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      transition: width 0.3s ease-in-out;
      z-index: 999;
      border-top-right-radius: 10px; /* Rounded corners */
      border-bottom-right-radius: 10px;
    }

    .new-container.open {
      width: 25%; /* col-md-3 equivalent width (25%) */
    }

    .main-content.shrink {
      margin-left: 330px; /* Adjust according to sidebar + new container */
    }
    .sticky-sidebar .instagram-icon {
      display: none;
    }
    .sticky-sidebar.shrink .instagram-icon {
      display: block;
    }
    .user-suggestion {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }
    .user-suggestion img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar: Categories -->
    <div class="col-md-2 bg-white p-3 border-end sticky-sidebar" id="sidebar">
      <a th:href="@{'/home/' + ${ownerId}}"><img src="/images/instagram-word-logo.png" style="width: 80%" alt="instagram-logo" class="category-text mb-3"></a>
      <a href="#" class="category-link instagram-icon fs-4 mb-5"><i class="fab fa-instagram"></i></a>
      <a th:href="@{'/home/' + ${ownerId}}" class="category-link"><i class="fas fa-home"></i><span class="category-text">Home</span></a>
      <a href="#" class="category-link" onclick="toggleSidebar()"><i class="fas fa-search"></i><span class="category-text">Search</span></a>
      <a href="#" class="category-link"><i class="far fa-compass"></i><span class="category-text">Explore</span></a>
      <a href="#" class="category-link"><i class="fas fa-clapperboard"></i><span class="category-text">Reels</span></a>
      <a href="#" class="category-link"><i class="far fa-envelope"></i><span class="category-text">Messages</span></a>
      <a href="#" class="category-link"><i class="far fa-heart"></i><span class="category-text">Notifications</span></a>
      <a href="#" class="category-link"><i class="fas fa-plus-circle"></i><span class="category-text">Create</span></a>
      <a th:href="@{'/user/' + ${ownerId} + '/profile'}" class="active category-link"><i class="far fa-user-circle"></i><span class="category-text">Profile</span></a>
    </div>

    <!-- New Container (will slide in) -->
    <div class="new-container" id="newContainer">
      <div class="container">
        <h3 class="mt-4"><strong>Search</strong></h3>

        <input id="search-input" type="text" placeholder="Search" class="form-control mt-5 mb-4" name="search" oninput="searchUser()" />
        <hr>
        <h6 class="mt-4"><strong>Recent</strong></h6>
        <div id="search-result"></div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-8 offset-1 overflow-auto main-content" id="mainContent">
      <!-- Profile Header -->
      <div class="row profile-header">
        <!-- Profile Image -->
        <div class="col-md-3 d-flex justify-content-center">
          <img th:if="${currentUser.getContent() == null}" src="/images/user-profile-icon-free-vector.jpg" alt="Profile" class="profile-img">
          <img th:unless="${currentUser.getContent() == null}" th:src="@{'/file/' + ${currentUser.getContent().getContenetName()}}" alt="Profile" class="profile-img">
        </div>
        <!-- Profile Info -->
        <div class="col-md-9">
          <div class="d-flex align-items-center mb-3">
            <h3 class="me-3" th:text="${currentUser.getUsername()}"></h3>
            <button class="btn btn-outline-secondary me-2" th:if="${currentUser.getId().equals(ownerId)}">Edit Profile</button>
            <button id="follow-button" class="btn me-2" th:unless="${currentUser.getId().equals(ownerId)}" th:value="${currentUser.getId()}"></button>
            <button class="btn btn-outline-secondary me-2" th:if="${currentUser.getId().equals(ownerId)}">View Archive</button>
            <button class="btn btn-outline-secondary me-2" th:unless="${currentUser.getId().equals(ownerId)}">Message</button>
            <a th:if="${currentUser.getId().equals(ownerId)}" class="btn btn-outline-secondary" type="button"><img src="/images/settings_1.jpg" alt="Settings" style="width: 24px; border-radius: 50%" /></a>
            <button th:unless="${currentUser.getId().equals(ownerId)}" type="button" class="btn btn-outline-secondary d-flex align-items-center"><span style="font-size: 24px; line-height: 1; text-align: center;">&centerdot;&centerdot;&centerdot;</span>
            </button>
          </div>
          <div class="mb-4">
            <strong>5</strong> posts &nbsp; <strong>315</strong> followers &nbsp; <strong>237</strong> following
          </div>
          <div class="mb-4"><strong th:text="${currentUser.getFullName()}"></strong> <span class="text-muted" th:if="${currentUser.getGender().toString().equals('MALE')}" th:text="'he/him'"></span>
            <span class="text-muted" th:unless="${currentUser.getGender().toString().equals('MALE')}" th:text="'she/her'"></span></div>
          <div><p th:text="${currentUser.getBio()}"></p></div>
        </div>
      </div>

      <!-- Stories Section -->
      <div class="d-flex justify-content-start my-5">
        <div class="text-center ms-5">
          <img src="https://via.placeholder.com/80" alt="Story" class="story-img">
          <p><strong>UZB</strong></p>
        </div>
        <div class="text-center ms-5">
          <img src="https://via.placeholder.com/80" alt="Story" class="story-img">
          <p><strong>KOR</strong></p>
        </div>
        <div class="text-center ms-5">
          <img src="https://via.placeholder.com/80" alt="Story" class="story-img">
          <p><strong>Traveling</strong></p>
        </div>
        <div class="text-center ms-5">
          <img src="https://via.placeholder.com/80" alt="Story" class="story-img">
          <p><strong>New</strong></p>
        </div>
      </div>

      <hr>

      <!-- Posts Navigation -->
      <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
          <a class="nav-link active" href="#"><i class="fas fa-th"></i> POSTS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#"><i class="far fa-bookmark"></i> SAVED</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#"><i class="fas fa-user-tag"></i> TAGGED</a>
        </li>
      </ul>

      <!-- Posts Grid -->
      <div class="row gx-1">
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
        <div class="col-md-4 mb-1">
          <img src="https://via.placeholder.com/300" alt="Post" class="post-img">
        </div>
      </div>

      <div class="mt-4 mb-4 text-center">
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Meta</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">About</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Blog</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Jobs</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Help</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Privacy</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Terms</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Locations</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Threads</a></li>
          <li class="list-inline-item"><a href="#" class="text-decoration-none">Contact</a></li>
        </ul>
        <p class="text-muted mb-0">&copy; 2024 Instagram from Meta</p>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  window.onload = function () {
      checkFollowExistence();
  }

  async function checkFollowExistence() {
    const followButton = document.getElementById('follow-button');
    const followingId = followButton.value;
    const url = "http://localhost:8080/follow/" + followingId + "/existence";
    const encodedUrl = encodeURI(url);
    try {
        const res = await fetch(encodedUrl);
        setFollow(await res.json());
    } catch (error) {
        console.log("Occur error: ", error);
    }
  }

  function setFollow(result) {
    const followButton = document.getElementById('follow-button');
    if (result) {
      followButton.classList.add('btn-outline-secondary');
      followButton.innerText = 'Following';
    } else {
      followButton.classList.add('btn-primary');
      followButton.innerText = 'Follow';
    }
  }

  async function searchUser() {
    const search = document.getElementById('search-input');
    if (search.value !== null) {
      const url = "http://localhost:8080/user/search/" + search.value;
      const encodedUrl = encodeURI(url);
      try {
        const res = await fetch(encodedUrl);
        renderSearchResult(await res.json());
      } catch (error) {
        console.log("Occur error: ", error);
      }
    }
  }

  function renderSearchResult(searchResult) {
    const result = document.getElementById('search-result');

    let temp = "";
    for (let i = 0; i < searchResult.length; i++) {
      temp += "<a href='/user/" + searchResult[i].id + "/profile' class='text-decoration-none text-dark'>\n" +
              "  <div class='user-suggestion d-flex align-items-center'>\n" +
              (searchResult[i].content == null
                      ? "    <img src='/images/user-profile-icon-free-vector.jpg' alt='User' class='rounded-circle' style='width: 50px; height: 50px;'>\n"
                      : "    <img src='/file/" + searchResult[i].content.contentName + "' alt='User' class='rounded-circle' style='width: 50px; height: 50px;'>\n") +
              "    <div class='d-flex flex-column justify-content-center' style='height: 100%;'>\n" +
              "      <span style='font-size: 12px; line-height: 1; font-weight: 900'>"
              + searchResult[i].username + "</span>\n" +
              "      <p class='m-0' style='font-size: 12px; line-height: 1;'>"
              + searchResult[i].fullName + "</p>\n" +
              "    </div>\n" +
              "  </div>\n" +
              "</a>";
    }
    result.innerHTML = temp;
  }

  // Sidebar toggle function
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const newContainer = document.getElementById('newContainer');
    const mainContent = document.getElementById('mainContent');

    // Toggle sidebar shrink effect
    sidebar.classList.toggle('shrink');
    mainContent.classList.toggle('shrink'); // To adjust main content position

    // Toggle new container visibility
    newContainer.classList.toggle('open');

    // Adjust the new container's position when the sidebar shrinks
    if (sidebar.classList.contains('shrink')) {
      newContainer.style.left = "80px";  // Adjust to the shrunk sidebar width
    } else {
      newContainer.style.left = "250px"; // Adjust back to the full sidebar width
    }
  }
</script>
</body>
</html>
